function VectorTile(n,t){var r,u,i;for(this.layers={},this._buffer=n,t=t||n.length;n.pos<t;)r=n.readVarint(),u=r>>3,u==3?(i=this._readLayer(),i.length&&(this.layers[i.name]=i)):n.skip(r);this.parseGeometries()}function VectorTileFeature(n,t,i,r,u){var e,f,o,s,h,c;for(this.properties={},this.extent=i,this.type=0,this._buffer=n,this._geometry=-1,t=t||n.length;n.pos<t;)if(e=n.readVarint(),f=e>>3,f==1)this._id=n.readVarint();else if(f==2)for(o=n.readVarint(),s=n.pos+o;n.pos<s;)h=r[n.readVarint()],c=u[n.readVarint()],this.properties[h]=c;else f==3?this.type=n.readVarint():f==4?(this._geometry=n.pos,n.skip(e)):n.skip(e)}function VectorTileLayer(n,t){this.version=1;this.name=null;this.extent=4096;this.length=0;this._buffer=n;this._keys=[];this._values=[];this._features=[];var r,i;for(t=t||n.length;n.pos<t;)r=n.readVarint(),i=r>>3,i===15?this.version=n.readVarint():i===1?this.name=n.readString():i===5?this.extent=n.readVarint():i===2?(this.length++,this._features.push(n.pos),n.skip(r)):i===3?this._keys.push(n.readString()):i===4?this._values.push(this.readFeatureValue()):n.skip(r)}function Point(n,t){this.x=n;this.y=t}function MVTFeature(n,t,i,r,u){if(!t)return null;for(var f in t)this[f]=t[f];this.mvtLayer=n;this.mvtSource=n.mvtSource;this.map=this.mvtSource.map;this.id=r;this.toggleEnabled=!0;this.selected=!1;this.divisor=t.extent/i.tileSize;this.extent=t.extent;this.tileSize=i.tileSize;this.tiles={};this.style=u;this.addTileFeature(t,i);u&&u.dynamicLabel&&typeof u.dynamicLabel=="function"&&(this.dynamicLabel=this.mvtSource.dynamicLabel.createFeature(this))}function removeLabels(n){for(var r,i=n.featuresWithLabels,t=0,u=i.length;t<u;t++)r=i[t],r.removeLabel();n.featuresWithLabels=[]}function in_circle(n,t,i,r,u){var f=Math.pow(n-r,2)+Math.pow(t-u,2);return f<=Math.pow(i,2)}!function(n){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=n();else if("function"==typeof define&&define.amd)define([],n);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this;t.Pbf=n()}}(function(){return function n(t,i,r){function u(f,o){var h,c,s;if(!i[f]){if(!t[f]){if(h="function"==typeof require&&require,!o&&h)return h(f,!0);if(e)return e(f,!0);c=new Error("Cannot find module '"+f+"'");throw c.code="MODULE_NOT_FOUND",c;}s=i[f]={exports:{}};t[f][0].call(s.exports,function(n){var i=t[f][1][n];return u(i?i:n)},s,s.exports,n,t,i,r)}return i[f].exports}for(var e="function"==typeof require&&require,f=0;f<r.length;f++)u(r[f]);return u}({1:[function(n,t){"use strict";function i(n){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(n)?n:new Uint8Array(n||0);this.pos=0;this.type=0;this.length=this.buf.length}function a(n,t,i){var f,r,e=i.buf;if((r=e[i.pos++],f=(112&r)>>4,r<128)||(r=e[i.pos++],f|=(127&r)<<3,r<128)||(r=e[i.pos++],f|=(127&r)<<10,r<128)||(r=e[i.pos++],f|=(127&r)<<17,r<128)||(r=e[i.pos++],f|=(127&r)<<24,r<128)||(r=e[i.pos++],f|=(1&r)<<31,r<128))return u(n,f,t);throw new Error("Expected varint not more than 10 bytes");}function r(n){return n.type===i.Bytes?n.readVarint()+n.pos:n.pos+1}function u(n,t,i){return i?4294967296*t+(n>>>0):4294967296*(t>>>0)+(n>>>0)}function v(n,t){var i,r;if(n>=0?(i=n%4294967296|0,r=n/4294967296|0):(i=~(-n%4294967296),r=~(-n/4294967296),4294967295^i?i=i+1|0:(i=0,r=r+1|0)),n>=0x10000000000000000||n<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10);y(i,r,t);p(r,t)}function y(n,t,i){i.buf[i.pos++]=127&n|128;n>>>=7;i.buf[i.pos++]=127&n|128;n>>>=7;i.buf[i.pos++]=127&n|128;n>>>=7;i.buf[i.pos++]=127&n|128;n>>>=7;i.buf[i.pos]=127&n}function p(n,t){var i=(7&n)<<4;t.buf[t.pos++]|=i|((n>>>=3)?128:0);n&&(t.buf[t.pos++]=127&n|((n>>>=7)?128:0),n&&(t.buf[t.pos++]=127&n|((n>>>=7)?128:0),n&&(t.buf[t.pos++]=127&n|((n>>>=7)?128:0),n&&(t.buf[t.pos++]=127&n|((n>>>=7)?128:0),n&&(t.buf[t.pos++]=127&n)))))}function c(n,t,i){var u=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.ceil(Math.log(t)/(7*Math.LN2)),r;for(i.realloc(u),r=i.pos-1;r>=n;r--)i.buf[r+u]=i.buf[r]}function w(n,t){for(var i=0;i<n.length;i++)t.writeVarint(n[i])}function b(n,t){for(var i=0;i<n.length;i++)t.writeSVarint(n[i])}function k(n,t){for(var i=0;i<n.length;i++)t.writeFloat(n[i])}function d(n,t){for(var i=0;i<n.length;i++)t.writeDouble(n[i])}function g(n,t){for(var i=0;i<n.length;i++)t.writeBoolean(n[i])}function nt(n,t){for(var i=0;i<n.length;i++)t.writeFixed32(n[i])}function tt(n,t){for(var i=0;i<n.length;i++)t.writeSFixed32(n[i])}function it(n,t){for(var i=0;i<n.length;i++)t.writeFixed64(n[i])}function rt(n,t){for(var i=0;i<n.length;i++)t.writeSFixed64(n[i])}function o(n,t){return(n[t]|n[t+1]<<8|n[t+2]<<16)+16777216*n[t+3]}function f(n,t,i){n[i]=t;n[i+1]=t>>>8;n[i+2]=t>>>16;n[i+3]=t>>>24}function l(n,t){return(n[t]|n[t+1]<<8|n[t+2]<<16)+(n[t+3]<<24)}function ut(n,t,i){for(var f,s,c,h="",u=t;u<i;){var e=n[u],r=null,o=e>239?4:e>223?3:e>191?2:1;if(u+o>i)break;1===o?e<128&&(r=e):2===o?(f=n[u+1],128==(192&f)&&(r=(31&e)<<6|63&f,r<=127&&(r=null))):3===o?(f=n[u+1],s=n[u+2],128==(192&f)&&128==(192&s)&&(r=(15&e)<<12|(63&f)<<6|63&s,(r<=2047||r>=55296&&r<=57343)&&(r=null))):4===o&&(f=n[u+1],s=n[u+2],c=n[u+3],128==(192&f)&&128==(192&s)&&128==(192&c)&&(r=(15&e)<<18|(63&f)<<12|(63&s)<<6|63&c,(r<=65535||r>=1114112)&&(r=null)));null===r?(r=65533,o=1):r>65535&&(r-=65536,h+=String.fromCharCode(r>>>10&1023|55296),r=56320|1023&r);h+=String.fromCharCode(r);u+=o}return h}function ft(n,t,i){for(var r,u,f=0;f<t.length;f++){if(r=t.charCodeAt(f),r>55295&&r<57344){if(!u){r>56319||f+1===t.length?(n[i++]=239,n[i++]=191,n[i++]=189):u=r;continue}if(r<56320){n[i++]=239;n[i++]=191;n[i++]=189;u=r;continue}r=u-55296<<10|r-56320|65536;u=null}else u&&(n[i++]=239,n[i++]=191,n[i++]=189,u=null);r<128?n[i++]=r:(r<2048?n[i++]=r>>6|192:(r<65536?n[i++]=r>>12|224:(n[i++]=r>>18|240,n[i++]=r>>12&63|128),n[i++]=r>>6&63|128),n[i++]=63&r|128)}return i}var e,s,h;t.exports=i;e=n("ieee754");i.Varint=0;i.Fixed64=1;i.Bytes=2;i.Fixed32=5;s=4294967296;h=1/s;i.prototype={destroy:function(){this.buf=null},readFields:function(n,t,i){for(i=i||this.length;this.pos<i;){var r=this.readVarint(),u=r>>3,f=this.pos;this.type=7&r;n(u,t,this);this.pos===f&&this.skip(r)}return t},readMessage:function(n,t){return this.readFields(n,t,this.readVarint()+this.pos)},readFixed32:function(){var n=o(this.buf,this.pos);return this.pos+=4,n},readSFixed32:function(){var n=l(this.buf,this.pos);return this.pos+=4,n},readFixed64:function(){var n=o(this.buf,this.pos)+o(this.buf,this.pos+4)*s;return this.pos+=8,n},readSFixed64:function(){var n=o(this.buf,this.pos)+l(this.buf,this.pos+4)*s;return this.pos+=8,n},readFloat:function(){var n=e.read(this.buf,this.pos,!0,23,4);return this.pos+=4,n},readDouble:function(){var n=e.read(this.buf,this.pos,!0,52,8);return this.pos+=8,n},readVarint:function(n){var i,t,r=this.buf;return t=r[this.pos++],i=127&t,t<128?i:(t=r[this.pos++],i|=(127&t)<<7,t<128?i:(t=r[this.pos++],i|=(127&t)<<14,t<128?i:(t=r[this.pos++],i|=(127&t)<<21,t<128?i:(t=r[this.pos],i|=(15&t)<<28,a(i,n,this)))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var n=this.readVarint();return n%2==1?(n+1)/-2:n/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var n=this.readVarint()+this.pos,t=ut(this.buf,this.pos,n);return this.pos=n,t},readBytes:function(){var n=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,n);return this.pos=n,t},readPackedVarint:function(n,t){var i=r(this);for(n=n||[];this.pos<i;)n.push(this.readVarint(t));return n},readPackedSVarint:function(n){var t=r(this);for(n=n||[];this.pos<t;)n.push(this.readSVarint());return n},readPackedBoolean:function(n){var t=r(this);for(n=n||[];this.pos<t;)n.push(this.readBoolean());return n},readPackedFloat:function(n){var t=r(this);for(n=n||[];this.pos<t;)n.push(this.readFloat());return n},readPackedDouble:function(n){var t=r(this);for(n=n||[];this.pos<t;)n.push(this.readDouble());return n},readPackedFixed32:function(n){var t=r(this);for(n=n||[];this.pos<t;)n.push(this.readFixed32());return n},readPackedSFixed32:function(n){var t=r(this);for(n=n||[];this.pos<t;)n.push(this.readSFixed32());return n},readPackedFixed64:function(n){var t=r(this);for(n=n||[];this.pos<t;)n.push(this.readFixed64());return n},readPackedSFixed64:function(n){var t=r(this);for(n=n||[];this.pos<t;)n.push(this.readSFixed64());return n},skip:function(n){var t=7&n;if(t===i.Varint)for(;this.buf[this.pos++]>127;);else if(t===i.Bytes)this.pos=this.readVarint()+this.pos;else if(t===i.Fixed32)this.pos+=4;else{if(t!==i.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(n,t){this.writeVarint(n<<3|t)},realloc:function(n){for(var i,t=this.length||16;t<this.pos+n;)t*=2;t!==this.length&&(i=new Uint8Array(t),i.set(this.buf),this.buf=i,this.length=t)},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(n){this.realloc(4);f(this.buf,n,this.pos);this.pos+=4},writeSFixed32:function(n){this.realloc(4);f(this.buf,n,this.pos);this.pos+=4},writeFixed64:function(n){this.realloc(8);f(this.buf,n&-1,this.pos);f(this.buf,Math.floor(n*h),this.pos+4);this.pos+=8},writeSFixed64:function(n){this.realloc(8);f(this.buf,n&-1,this.pos);f(this.buf,Math.floor(n*h),this.pos+4);this.pos+=8},writeVarint:function(n){return n=+n||0,n>268435455||n<0?void v(n,this):(this.realloc(4),this.buf[this.pos++]=127&n|(n>127?128:0),void(n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=n>>>7&127)))))},writeSVarint:function(n){this.writeVarint(n<0?2*-n-1:2*n)},writeBoolean:function(n){this.writeVarint(Boolean(n))},writeString:function(n){var i,t;n=String(n);this.realloc(4*n.length);this.pos++;i=this.pos;this.pos=ft(this.buf,n,this.pos);t=this.pos-i;t>=128&&c(i,t,this);this.pos=i-1;this.writeVarint(t);this.pos+=t},writeFloat:function(n){this.realloc(4);e.write(this.buf,n,this.pos,!0,23,4);this.pos+=4},writeDouble:function(n){this.realloc(8);e.write(this.buf,n,this.pos,!0,52,8);this.pos+=8},writeBytes:function(n){var i=n.length,t;for(this.writeVarint(i),this.realloc(i),t=0;t<i;t++)this.buf[this.pos++]=n[t]},writeRawMessage:function(n,t){var r,i;this.pos++;r=this.pos;n(t,this);i=this.pos-r;i>=128&&c(r,i,this);this.pos=r-1;this.writeVarint(i);this.pos+=i},writeMessage:function(n,t,r){this.writeTag(n,i.Bytes);this.writeRawMessage(t,r)},writePackedVarint:function(n,t){this.writeMessage(n,w,t)},writePackedSVarint:function(n,t){this.writeMessage(n,b,t)},writePackedBoolean:function(n,t){this.writeMessage(n,g,t)},writePackedFloat:function(n,t){this.writeMessage(n,k,t)},writePackedDouble:function(n,t){this.writeMessage(n,d,t)},writePackedFixed32:function(n,t){this.writeMessage(n,nt,t)},writePackedSFixed32:function(n,t){this.writeMessage(n,tt,t)},writePackedFixed64:function(n,t){this.writeMessage(n,it,t)},writePackedSFixed64:function(n,t){this.writeMessage(n,rt,t)},writeBytesField:function(n,t){this.writeTag(n,i.Bytes);this.writeBytes(t)},writeFixed32Field:function(n,t){this.writeTag(n,i.Fixed32);this.writeFixed32(t)},writeSFixed32Field:function(n,t){this.writeTag(n,i.Fixed32);this.writeSFixed32(t)},writeFixed64Field:function(n,t){this.writeTag(n,i.Fixed64);this.writeFixed64(t)},writeSFixed64Field:function(n,t){this.writeTag(n,i.Fixed64);this.writeSFixed64(t)},writeVarintField:function(n,t){this.writeTag(n,i.Varint);this.writeVarint(t)},writeSVarintField:function(n,t){this.writeTag(n,i.Varint);this.writeSVarint(t)},writeStringField:function(n,t){this.writeTag(n,i.Bytes);this.writeString(t)},writeFloatField:function(n,t){this.writeTag(n,i.Fixed32);this.writeFloat(t)},writeDoubleField:function(n,t){this.writeTag(n,i.Fixed64);this.writeDouble(t)},writeBooleanField:function(n,t){this.writeVarintField(n,Boolean(t))}}},{ieee754:2}],2:[function(n,t,i){i.read=function(n,t,i,r,u){var f,o,l=8*u-r-1,a=(1<<l)-1,v=a>>1,e=-7,s=i?u-1:0,c=i?-1:1,h=n[t+s];for(s+=c,f=h&(1<<-e)-1,h>>=-e,e+=l;e>0;f=256*f+n[t+s],s+=c,e-=8);for(o=f&(1<<-e)-1,f>>=-e,e+=r;e>0;o=256*o+n[t+s],s+=c,e-=8);if(0===f)f=1-v;else{if(f===a)return o?NaN:(h?-1:1)*(1/0);o+=Math.pow(2,r);f-=v}return(h?-1:1)*o*Math.pow(2,f-r)};i.write=function(n,t,i,r,u,f){var e,o,s,l=8*f-u-1,a=(1<<l)-1,h=a>>1,y=23===u?Math.pow(2,-24)-Math.pow(2,-77):0,c=r?0:f-1,v=r?1:-1,p=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(o=isNaN(t)?1:0,e=a):(e=Math.floor(Math.log(t)/Math.LN2),t*(s=Math.pow(2,-e))<1&&(e--,s*=2),t+=e+h>=1?y/s:y*Math.pow(2,1-h),t*s>=2&&(e++,s/=2),e+h>=a?(o=0,e=a):e+h>=1?(o=(t*s-1)*Math.pow(2,u),e+=h):(o=t*Math.pow(2,h-1)*Math.pow(2,u),e=0));u>=8;n[i+c]=255&o,c+=v,o/=256,u-=8);for(e=e<<u|o,l+=u;l>0;n[i+c]=255&e,c+=v,e/=256,l-=8);n[i+c-v]|=128*p}},{}]},{},[1])(1)});VectorTile.prototype._readLayer=function(){var n=this._buffer,i=n.readVarint(),t=n.pos+i,r=new VectorTileLayer(n,t);return n.pos=t,r};VectorTile.prototype.parseGeometries=function(){var r,n,u,t,f,i;for(r in this.layers)for(n=this.layers[r],n.parsedFeatures=[],u=n._features.length,t=0,f=u;t<f;t++)i=n.feature(t),i.coordinates=i.loadGeometry(),n.parsedFeatures.push(i)};VectorTileFeature.types=["Unknown","Point","LineString","Polygon"];VectorTileFeature.prototype.loadGeometry=function(){var t=this._buffer,f;t.pos=this._geometry;for(var s=t.readVarint(),h=t.pos+s,i=1,r=0,e=0,o=0,u=[],n;t.pos<h;)if(r||(f=t.readVarint(),i=f&7,r=f>>3),r--,i===1||i===2)e+=t.readSVarint(),o+=t.readSVarint(),i===1&&(n&&u.push(n),n=[]),n.push(new Point(e,o));else if(i===7)n.push(n[0].clone());else throw new Error("unknown command "+i);return n&&u.push(n),u};VectorTileFeature.prototype.bbox=function(){var n=this._buffer,h;n.pos=this._geometry;for(var c=n.readVarint(),l=n.pos+c,t=1,u=0,i=0,r=0,f=Infinity,e=-Infinity,o=Infinity,s=-Infinity;n.pos<l;)if(u||(h=n.readVarint(),t=h&7,u=h>>3),u--,t===1||t===2)i+=n.readSVarint(),r+=n.readSVarint(),i<f&&(f=i),i>e&&(e=i),r<o&&(o=r),r>s&&(s=r);else if(t!==7)throw new Error("unknown command "+t);return[f,o,e,s]};VectorTileLayer.prototype.readFeatureValue=function(){for(var n=this._buffer,i=null,u=n.readVarint(),f=n.pos+u,r,t;n.pos<f;)if(r=n.readVarint(),t=r>>3,t==1)i=n.readString();else if(t==2)throw new Error("read float");else if(t==3)i=n.readDouble();else if(t==4)i=n.readVarint();else if(t==5)throw new Error("read uint");else t==6?i=n.readSVarint():t==7?i=Boolean(n.readVarint()):n.skip(r);return i};VectorTileLayer.prototype.feature=function(n){if(n<0||n>=this._features.length)throw new Error("feature index out of bounds");this._buffer.pos=this._features[n];var t=this._buffer.readVarint()+this._buffer.pos;return new VectorTileFeature(this._buffer,t,this.extent,this._keys,this._values)};Point.prototype={clone:function(){return new Point(this.x,this.y)},add:function(n){return this.clone()._add(n)},sub:function(n){return this.clone()._sub(n)},mult:function(n){return this.clone()._mult(n)},div:function(n){return this.clone()._div(n)},rotate:function(n){return this.clone()._rotate(n)},matMult:function(n){return this.clone()._matMult(n)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(n){return this.x===n.x&&this.y===n.y},dist:function(n){return Math.sqrt(this.distSqr(n))},distSqr:function(n){var t=n.x-this.x,i=n.y-this.y;return t*t+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(n){return Math.atan2(this.y-n.y,this.x-n.x)},angleWith:function(n){return this.angleWithSep(n.x,n.y)},angleWithSep:function(n,t){return Math.atan2(this.x*t-this.y*n,this.x*n+this.y*t)},_matMult:function(n){var t=n[0]*this.x+n[1]*this.y,i=n[2]*this.x+n[3]*this.y;return this.x=t,this.y=i,this},_add:function(n){return this.x+=n.x,this.y+=n.y,this},_sub:function(n){return this.x-=n.x,this.y-=n.y,this},_mult:function(n){return this.x*=n,this.y*=n,this},_div:function(n){return this.x/=n,this.y/=n,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var n=this.y;return this.y=this.x,this.x=-n,this},_rotate:function(n){var t=Math.cos(n),i=Math.sin(n),r=t*this.x-i*this.y,u=i*this.x+t*this.y;return this.x=r,this.y=u,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}};Point.convert=function(n){return n instanceof Point?n:Array.isArray(n)?new Point(n[0],n[1]):n};MVTFeature.prototype._setStyle=function(n){this.style=n(this,this.ajaxData);this.removeLabel()};MVTFeature.prototype.setStyle=function(n){this.style=n(this,null);this.removeLabel()};MVTFeature.prototype.draw=function(n){var u=this.tiles[n],t=u.vtf,i=u.ctx,r;i.canvas=this.mvtLayer.getCanvas(n);r=this.selected?this.style.selected||this.style:this.style;switch(t.type){case 1:if(this._drawPoint(i,t.coordinates,r),!this.staticLabel&&typeof this.style.staticLabel=="function"){if(this.style.ajaxSource&&!this.ajaxData)break;this._drawStaticLabel(i,t.coordinates,r)}break;case 2:this._drawLineString(i,t.coordinates,r);break;case 3:this._drawPolygon(i,t.coordinates,r);break;default:throw new Error("Unmanaged type: "+t.type);}};MVTFeature.prototype.getPathsForTile=function(n){return this.tiles[n].paths};MVTFeature.prototype.addTileFeature=function(n,t){var i=this.map.getZoom();t.zoom==i&&(this.clearTileFeatures(i),this.tiles[t.id]={ctx:t,vtf:n,paths:[]})};MVTFeature.prototype.clearTileFeatures=function(n){for(var t in this.tiles)t.split(":")[0]!=n&&delete this.tiles[t]};MVTFeature.prototype.redrawTiles=function(){var i=this.map.getZoom(),n,t;for(n in this.tiles)t=parseInt(n.split(":")[0]),t===i&&this.mvtSource.redrawTile(n)};MVTFeature.prototype.toggle=function(){this.selected?this.deselect():this.select()};MVTFeature.prototype.select=function(){this.selected=!0;this.mvtSource.featureSelected(this);this.redrawTiles()};MVTFeature.prototype.deselect=function(){this.selected=!1;this.mvtSource.featureDeselected(this);this.redrawTiles()};MVTFeature.prototype.on=function(n,t){this._eventHandlers[n]=t};MVTFeature.prototype._drawPoint=function(n,t,i){var e,f,u,r;i&&n&&n.canvas&&(e=this.tiles[n.id],f=1,f=typeof i.radius=="function"?i.radius(n.zoom):i.radius,u=this._tilePoint(t[0][0]),r=n.canvas.getContext("2d"),r.beginPath(),r.fillStyle=i.color,r.arc(u.x,u.y,f,0,Math.PI*2),r.closePath(),r.fill(),i.lineWidth&&i.strokeStyle&&(r.lineWidth=i.lineWidth,r.strokeStyle=i.strokeStyle,r.stroke()),r.restore(),e.paths.push([u]))};MVTFeature.prototype._drawLineString=function(n,t,r){var u,e,s,h,o,c,f;if(r&&n&&n.canvas){u=n.canvas.getContext("2d");u.strokeStyle=r.color;u.lineWidth=r.size;u.beginPath();e=[];s=this.tiles[n.id];for(h in t)for(o=t[h],i=0;i<o.length;i++)c=(i===0?"move":"line")+"To",f=this._tilePoint(o[i]),e.push(f),u[c](f.x,f.y);u.stroke();u.restore();s.paths.push(e)}};MVTFeature.prototype._drawPolygon=function(n,t,i){var r,u,e,l,o,f;if(i&&n&&n.canvas){r=n.canvas.getContext("2d");u=i.outline;r.fillStyle=typeof i.color=="function"?i.color(r):i.color;u&&(r.strokeStyle=u.color,r.lineWidth=u.size);r.beginPath();var h=[],a=this.tiles[n.id],c=this.dynamicLabel;for(c&&c.addTilePolys(n,t),e=0,l=t.length;e<l;e++)for(o=t[e],f=0;f<o.length;f++){var v=o[f],y=(f===0?"move":"line")+"To",s=this._tilePoint(v);h.push(s);r[y](s.x,s.y)}r.closePath();r.fill();u&&r.stroke();a.paths.push(h)}};MVTFeature.prototype._drawStaticLabel=function(n,t,i){if(i&&n&&this.mvtLayer._map){var u=this._tilePoint(t[0][0]),r=this._project(u,n.tile.x,n.tile.y,this.extent,this.tileSize),f=L.point(r.x,r.y),e=this.map.unproject(f);this.staticLabel=new StaticLabel(this,n,e,i);this.mvtLayer.featureWithLabelAdded(this)}};MVTFeature.prototype.removeLabel=function(){this.staticLabel&&(this.staticLabel.remove(),this.staticLabel=null)};MVTFeature.prototype._project=function(n,t,i,r,u){var f=t*u,e=i*u;return{x:Math.floor(n.x+f),y:Math.floor(n.y+e)}};MVTFeature.prototype._tilePoint=function(n){return{x:n.x/this.divisor,y:n.y/this.divisor}};class MVTLayer{constructor(n,t){this.mvtSource=n;this.map=n.map;this.lineClickTolerance=2;this.getIDForLayerFeature=t.getIDForLayerFeature||!1;this.filter=t.filter||!1;this.layerOrdering=t.layerOrdering||!1;this.asynch=t.asynch||!0;this._featureIsClicked={};this.style=t.style;this.name=t.name;this._canvasIDToFeatures={};this.features={};this.featuresWithLabels=[];this._highestCount=0;this._tilesCanvas=[]}_isPointInPolygon(n,t){if(t&&t.length){for(var u=!1,i=-1,f=t.length,r=f-1;++i<f;r=i)(t[i].y<=n.y&&n.y<t[r].y||t[r].y<=n.y&&n.y<t[i].y)&&n.x<(t[r].x-t[i].x)*(n.y-t[i].y)/(t[r].y-t[i].y)+t[i].x&&(u=!u);return u}}_getDistanceFromLine(n,t){var r=Number.POSITIVE_INFINITY,i,f,u;if(t&&t.length>1)for(n=L.point(n.x,n.y),i=0,f=t.length-1;i<f;i++)u=this._projectPointOnLineSegment(n,t[i],t[i+1]),u.distance<=r&&(r=u.distance);return r}_projectPointOnLineSegment(n,t,i){var f=t.distanceTo(i),r,u;return f<1?{distance:n.distanceTo(t),coordinate:t}:(r=((n.x-t.x)*(i.x-t.x)+(n.y-t.y)*(i.y-t.y))/Math.pow(f,2),r<1e-7)?{distance:n.distanceTo(t),coordinate:t}:r>.9999999?{distance:n.distanceTo(i),coordinate:i}:(u=L.point(t.x+r*(i.x-t.x),t.y+r*(i.y-t.y)),{distance:n.distanceTo(u),point:u})}_initializeFeaturesHash(n){this._canvasIDToFeatures[n.id]={};this._canvasIDToFeatures[n.id].features=[];this._canvasIDToFeatures[n.id].canvas=n.canvas}parseVectorTileLayer(n,t){var a=this,s,u,c,i,h,l,o,r,e,f;for(this._setCanvas(t.id,t.canvas),this._canvasIDToFeatures[t.id]?this.clearTileFeatureHash(t.id):this._initializeFeaturesHash(t),s=n.parsedFeatures,u=0,c=s.length;u<c;u++)(i=s[u],i.layer=n,h=this.filter,typeof h!="function"||h(i,t)!==!1)&&(f=this.layerOrdering,typeof f=="function"&&f(i,t),l=typeof this.getIDForLayerFeature=="function"?this.getIDForLayerFeature:Util.getIDForLayerFeature,o=l(i)||u,r=this.features[o],r?r.addTileFeature(i,t):(e=this.style(i),r=new MVTFeature(this,i,t,o,e),this.features[o]=r,e&&e.dynamicLabel&&typeof e.dynamicLabel=="function"&&this.featuresWithLabels.push(r)),t&&t.id&&a._canvasIDToFeatures[t.id].features.push(r));f=this.layerOrdering;f&&(this._canvasIDToFeatures[t.id].features=this._canvasIDToFeatures[t.id].features.sort(function(n,t){return-(t.properties.zIndex-n.properties.zIndex)}))}_setCanvas(n,t){this._tilesCanvas[n]=t}getCanvas(n){return this._tilesCanvas[n]}setStyle(n){var i,t;this.style=n;for(t in this.features)i=this.features[t],i.setStyle(n);for(t in this._tilesCanvas)this.drawTile(t)}handleClickEvent(n,t){var v=n.tileID,p=n.tileID.split(":")[0],w=this._tilesCanvas[v],s,i,h,o,a;if(!w){t(n);return}var c=n.tilePoint,l=this._canvasIDToFeatures[n.tileID].features,e=Number.POSITIVE_INFINITY,f=null,r,u,o;for(s=0;s<l.length;s++){i=l[s];switch(i.type){case 1:for(h=3,h=typeof i.style.radius=="function"?i.style.radius(p):i.style.radius,u=i.getPathsForTile(n.tileID),r=0;r<u.length;r++)in_circle(u[r][0].x,u[r][0].y,h,x,y)&&(f=i,e=0);break;case 2:for(u=i.getPathsForTile(n.tileID),r=0;r<u.length;r++)i.style&&(o=this._getDistanceFromLine(c,u[r]),a=i.selected&&i.style.selected?i.style.selected.size:i.style.size,o<a/2+this.lineClickTolerance&&o<e&&(f=i,e=o));break;case 3:for(u=i.getPathsForTile(n.tileID),r=0;r<u.length;r++)this._isPointInPolygon(c,u[r])&&(f=i,e=0)}if(e==0)break}f&&f.toggleEnabled&&f.toggle();n.feature=f;t(n)}clearTileFeatureHash(n){this._canvasIDToFeatures[n]={features:[]}}clearLayerFeatureHash(){this.features={}}drawTile(n){var e=this._canvasIDToFeatures[n],f,i,r,u,o,t;if(e){for(f=e.features,i=[],r=0;r<f.length;r++)t=f[r],t.selected?i.push(t):t.draw(n);for(u=0,o=i.length;u<o;u++)t=i[u],t.draw(n)}}_resetCanvasIDToFeatures(n,t){this._canvasIDToFeatures[n]={};this._canvasIDToFeatures[n].features=[];this._canvasIDToFeatures[n].canvas=t}linkedLayer(){if(this.mvtSource.layerLink){var n=this.mvtSource.layerLink(this.name);return this.mvtSource.layers[n]}return null}featureWithLabelAdded(n){this.featuresWithLabels.push(n)}}class MVTSource{constructor(n,t){this.map=n;this.url=t.url||"";this.debug=t.debug||!1;this.getIDForLayerFeature=t.getIDForLayerFeature||function(n){return n.properties.id};this.visibleLayers=t.visibleLayers||[];this.xhrHeaders=t.xhrHeaders||{};this.clickableLayers=t.clickableLayers||!1;this.filter=t.filter||!1;this.mutexToggle=t.mutexToggle||!1;this.cache=t.cache||!1;this._tileSize=t.tileSize||256;this.tileSize=new google.maps.Size(this._tileSize,this._tileSize);typeof t.style=="function"&&(this.style=t.style);this.mVTLayers={};this.vectorTilesProcessed={};this.visibleTiles={}}getTile(n,t,i){const r=i.createElement("canvas");return r.width=this._tileSize,r.height=this._tileSize,this.drawTile(r,n,t),r}releaseTile(n){delete this.visibleTiles[n.id]}style(n){var t={},i=n.type;switch(i){case 1:t.color="rgba(49,79,79,1)";t.radius=5;t.selected={color:"rgba(255,255,0,0.5)",radius:6};break;case 2:t.color="rgba(161,217,155,0.8)";t.size=3;t.selected={color:"rgba(255,25,0,0.5)",size:4};break;case 3:t.color="rgba(49,79,79, 0.4)";t.outline={color:"rgba(161,217,155,0.8)",size:1};t.selected={color:"rgba(255,140,0,0.3)",outline:{color:"rgba(255,140,0,1)",size:2}}}return t}drawTile(n,t,i){var r={x:t.x,y:t.y},f=n.id=this._getTileId(i,r.x,r.y),u={id:f,canvas:n,tile:r,zoom:i,tileSize:this._tileSize};this._drawDebugInfo(u);this._draw(u)}_getTileId(n,t,i){return[n,t,i].join(":")}_drawDebugInfo(n){if(this.debug){var i=this.tileSize.width,r=this.tileSize.height,t=n.canvas.getContext("2d");t.strokeStyle="#000000";t.fillStyle="#FFFF00";t.strokeRect(0,0,i,r);t.font="12px Arial";t.fillRect(0,0,5,5);t.fillRect(0,r-5,5,5);t.fillRect(i-5,0,5,5);t.fillRect(i-5,r-5,5,5);t.fillRect(i/2-5,r/2-5,10,10);t.strokeText(n.zoom+" "+n.tile.x+" "+n.tile.y,i/2-30,r/2-10)}}_draw(n){var e=this,u=this.vectorTilesProcessed[n.id],f,t,i,r;if(u)return this._drawVectorTile(u,n);if(this.url){f=this.url.replace("{z}",n.zoom).replace("{x}",n.tile.x).replace("{y}",n.tile.y);t=new XMLHttpRequest;t.onload=function(){t.status=="200"&&t.response&&e._xhrResponseOk(n,t.response)};t.onerror=function(){};t.open("GET",f,!0);i=this.xhrHeaders;for(r in i)t.setRequestHeader(r,i[r]);t.responseType="arraybuffer";t.send()}}_xhrResponseOk = function(n,t){if(!this.map||this.map.getZoom()==n.zoom){var r=new Uint8Array(t),u=new Pbf(r),i=new VectorTile(u);this.cache&&(this.vectorTilesProcessed[n.id]=i);this._drawVectorTile(i,n)}}_drawVectorTile(n,t){var r,i,u;if(this.visibleLayers&&this.visibleLayers.length>0)for(r=0;r<this.visibleLayers.length;r++)i=this.visibleLayers[r],n.layers[i]&&(u=n.layers[i],this._drawVectorTileLayer(u,i,t));else for(i in n.layers)u=n.layers[i],this._drawVectorTileLayer(u,i,t);this._addVisibleTile(n,t)}_drawVectorTileLayer(n,t,i){this.mVTLayers[t]||(this.mVTLayers[t]=this._createMVTLayer(t));var r=this.mVTLayers[t];r.parseVectorTileLayer(n,i);r.drawTile(i.id)}_createMVTLayer(n){var t={getIDForLayerFeature:this.getIDForLayerFeature,filter:this.filter,layerOrdering:this.layerOrdering,style:this.style,name:n,asynch:!0};return new MVTLayer(this,t)}_addVisibleTile(n,t){t.vectorTile=n;this.visibleTiles[t.id]=t}getLayers(){return this.mVTLayers}onClick(n,t){var i=this.clickableLayers,e=this.map.getZoom(),u=MERCATOR.getTileAtLatLng(n.latLng,e),r,o,s,f;if(n.tileID=this._getTileId(u.z,u.x,u.y),n.tilePoint=MERCATOR.fromLatLngToTilePoint(map,n,e),i||(i=Object.keys(this.mVTLayers)),i&&i.length>0)for(r=0,o=i.length;r<o;r++)s=i[r],f=this.mVTLayers[s],f&&f.handleClickEvent(n,function(n){typeof t=="function"&&t(n)});else typeof t=="function"&&t(n)}setFilter(n){for(var t in this.mVTLayers)this.mVTLayers[t].filter=n;this.redrawTiles()}setStyle(n){for(var t in this.mVTLayers)this.mVTLayers[t].setStyle(n);this.redrawTiles()}redrawTiles(){for(var n in this.visibleTiles)this.redrawTile(n)}redrawTile(n){var t=this.visibleTiles[n];t&&(this.clearTile(t),this._drawVectorTile(t.vectorTile,t))}clearTile(n){var t=n.canvas,i=t.getContext("2d");i.clearRect(0,0,t.width,t.height)}deselectFeature(){this._selectedFeature&&(this._selectedFeature.deselect(),this._selectedFeature=!1)}featureSelected(n){if(this.mutexToggle&&(this._selectedFeature&&this._selectedFeature.deselect(),this._selectedFeature=n),this.onSelect)this.onSelect(n)}featureDeselected(n){if(this.mutexToggle&&this._selectedFeature&&(this._selectedFeature=null),this.onDeselect)this.onDeselect(n)}}MERCATOR={fromLatLngToPoint:function(n){var t=Math.min(Math.max(Math.sin(n.lat()*(Math.PI/180)),-.9999),.9999);return{x:128+n.lng()*(256/360),y:128+.5*Math.log((1+t)/(1-t))*-(128/Math.PI)}},fromPointToLatLng:function(n){return{lat:(2*Math.atan(Math.exp((n.y-128)/-(128/Math.PI)))-Math.PI/2)/(Math.PI/180),lng:(n.x-128)/(256/360)}},getTileAtLatLng:function(n,t){var u=Math.pow(2,t),i=256/u,r=this.fromLatLngToPoint(n);return{x:Math.floor(r.x/i),y:Math.floor(r.y/i),z:t}},getTileBounds:function(n){n=this.normalizeTile(n);var i=Math.pow(2,n.z),t=256/i,r={x:n.x*t,y:n.y*t+t},u={x:n.x*t+t,y:n.y*t};return{sw:this.fromPointToLatLng(r),ne:this.fromPointToLatLng(u)}},normalizeTile:function(n){var t=Math.pow(2,n.z);return n.x=(n.x%t+t)%t,n.y=(n.y%t+t)%t,n},fromLatLngToPixels:function(n,t){var i=n.getBounds(),f=i.getNorthEast(),e=i.getSouthWest(),o=n.getProjection().fromLatLngToPoint(f),s=n.getProjection().fromLatLngToPoint(e),r=Math.pow(2,n.getZoom()),u=n.getProjection().fromLatLngToPoint(t);return new google.maps.Point((u.x-s.x)*r,(u.y-o.y)*r)},fromLatLngToTilePoint:function(n,t,i){var u=this.getTileAtLatLng(t.latLng,i),r=this.getTileBounds(u),f=new google.maps.LatLng(r.sw),e=new google.maps.LatLng(r.ne),o=this.fromLatLngToPixels(n,f),s=this.fromLatLngToPixels(n,e);return{x:t.pixel.x-o.x,y:t.pixel.y-s.y}}};